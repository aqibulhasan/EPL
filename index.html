<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="main.css" />
    </head>
    <body>
        <div class="scoreboard">
            <header class="scoreboard__title">
                <img src="./image/download" alt="" />
            </header>

            <main class="scoreboard__main">
                <div class="scoreboard__team">
                    <span id="team-1"></span>
                    <div class="scoreboard__card__container">
                        <span id="red-card-team-1"></span>
                        <span id="yellow-card-team-1"></span>
                    </div>
                </div>
                <div class="scoreboard__score">
                    <span
                        class="scoreboard__score--left"
                        id="team-1-score"
                    ></span>
                    <span class="scoreboard__score--timer"></span>
                    <span
                        class="scoreboard__score--right"
                        id="team-2-score"
                    ></span>
                </div>

                <div class="scoreboard__team">
                    <span id="team-2"></span>
                    <div class="scoreboard__card__container">
                        <span id="red-card-team-2"></span>
                        <span id="yellow-card-team-2"></span>
                    </div>
                </div>
            </main>

            <footer class="scoreboard__period"></footer>
        </div>
        <script>
            let data = JSON.parse(localStorage.getItem("scoreboardData")) || {
                team1: "",
                team2: "",
                score1: 0,
                score2: 0,
                yellowCard1: 0,
                yellowCard2: 0,
                redCard1: 0,
                redCard2: 0,
                period: "",
                elapsedMillis: 0,
                isRunning: false,
                lastUpdateTimestamp: null,
            };
            let stopwatchInterval = null;


            function formatTime(millis) {
                const totalSeconds = Math.floor(millis / 1000);
                const minutes = Math.floor(totalSeconds / 60)
                    .toString()
                    .padStart(2, "0");
                const seconds = (totalSeconds % 60).toString().padStart(2, "0");
                return `${minutes}:${seconds}`;
            }

            function calculateElapsed() {
                if (!data.isRunning) return data.elapsedMillis;
                return data.elapsedMillis + (Date.now() - data.lastUpdateTimestamp);
            }

            function renderRedCard(team1RedCard, team2RedCard) {
                document.getElementById('red-card-team-1').innerHTML =
                    '<span class="scoreboard_card red-card">&nbsp</span>'.repeat(team1RedCard);
                document.getElementById('red-card-team-2').innerHTML =
                    '<span class="scoreboard_card red-card">&nbsp</span>'.repeat(team2RedCard);
            }

            function renderYellowCard(team1YellowCard, team2YellowCard) {
                document.getElementById('yellow-card-team-1').innerHTML =
                    '<span class="scoreboard_card yellow-card">&nbsp</span>'.repeat(team1YellowCard);
                document.getElementById('yellow-card-team-2').innerHTML =
                    '<span class="scoreboard_card yellow-card">&nbsp</span>'.repeat(team2YellowCard);
            }

            function updateStopwatchUI() {
                const elapsed = calculateElapsed();
                document.querySelector(
                    ".scoreboard__score--timer"
                ).textContent = formatTime(elapsed);
            }

            function updateUI() {
                document.getElementById("team-1").textContent = data.team1;
                document.getElementById("team-2").textContent = data.team2;
                document.getElementById("team-1-score").textContent =
                    data.score1;
                document.getElementById("team-2-score").textContent =
                    data.score2;
                document.querySelector(".scoreboard__period").textContent =
                    data.period;
                    renderRedCard(data.redCard1, data.redCard2);
                    renderYellowCard(data.yellowCard1, data.yellowCard2);
                updateStopwatchUI();

                clearInterval(stopwatchInterval);
                stopwatchInterval = null;

                if (data.isRunning) {
                    stopwatchInterval = setInterval(updateStopwatchUI, 1000);
                }
            }

            updateUI();

            window.addEventListener("storage", (event) => {
                if (event.key === "scoreboardData") {
                    data = JSON.parse(event.newValue) || data;
                    updateUI();
                }
            });
        </script>
    </body>
</html>
